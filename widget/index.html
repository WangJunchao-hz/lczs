<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <script src="./script/lib/utils/rem/1.0.0/rem.js"></script>
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>入口页</title>
    <link rel="stylesheet" type="text/css" href="./css/aui/2.1.0/aui.css"/>
    <!--<link rel="stylesheet" type="text/css" href="./fonts/iconfont.css" />-->
    <link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_w63v64fnwzhq6w29.css"/>
    <link rel="stylesheet" type="text/css" href="./css/conf/index.css"/>
</head>

<body>
<header id="jHeader" class="aui-bar aui-bar-nav">欢迎使用鑫钱包</header>
<footer id="jFooter" class="aui-bar aui-bar-tab">
    <div class="aui-bar-tab-item" data-index="0" tapmode>
        <i class="iconfont icon-zichan"></i>
        <div class="aui-bar-tab-label">资产</div>
    </div>
    <div class="aui-bar-tab-item" data-index="1" tapmode>
        <div id="jAdd" class="add" tapmode>
            <span class="iconfont icon-tianjia"></span>
        </div>
        <div class="keai aui-hide">
            <span class="iconfont icon-keai"></span>
        </div>
    </div>
    <div class="aui-bar-tab-item" data-index="2" tapmode>
        <i class="aui-iconfont aui-icon-my"></i>
        <div class="aui-bar-tab-label">我的</div>
    </div>
</footer>
</body>
<script type="text/javascript" data-main="./script/app" src="./script/lib/require/2.1.11/require.js"></script>
<script type="text/javascript" src="./script/app.js"></script>
<!-- apiready必须放在这里才能生效 -->
<script type="text/javascript">
    apiready = function () {
        require(['common','date'],function(common,date) {
            /**
             * @description: 新建一个类
             */
            function Index() {
                this.init();
                this.initUI();
                this.events();
            }

            /**
             * @description: 初始化参数(全局变量+常量)
             */
            Index.prototype.init = function() {
                var self = this;
                //缓存全局变量
                self.title = (date.periods().indexOf('深夜') != -1 ?  '夜深了,请注意休息' : (date.periods().indexOf('晨') != -1 ? '早起的鸟儿有虫吃' : date.periods() + '好'));

                //缓存全局dom对象
            };

            /**
             * @description: 初始化页面(首屏)
             */
            Index.prototype.initUI = function() {
                var self = this;
                $('#jHeader').html(self.title);
                common.methods().openFrame('welcome_frm','./html/welcome/welcome_frm.html',0,'',true);
            };

            /**
             * @description: 事件管理
             */
            Index.prototype.events = function() {
                var self = this;

                api.addEventListener({
                    name: 'addAccountSuccess'
                }, function(ret, err){
                    $($('#jFooter .aui-bar-tab-item')[0]).addClass('aui-active').siblings().removeClass('aui-active');
                    self.methods().iconSwitch(false);
                    common.methods().openFrame('main_frm','./html/main_frm.html',0,'',true);
                });


                //添加数据
                $('#jAdd').click(function() {
                    var isFist = $api.getStorage('isFist');
                    var btnArry = ['添加账户', '快速记账'];
                    if(isFist != '1'){
                        btnArry = ['添加账户'];
                    }
                    api.actionSheet({
                        title: '请选择',
                        cancelTitle: '取消',
                        buttons: btnArry
                    }, function(ret, err) {
                        var index = ret.buttonIndex;
                        switch (index){
                            case 1:
                                common.methods().openWin('add','./html/accounts/add.html');
                                break;
                            case 2:
                                break;
                        }
                    });
                });

                //底部菜单栏导航
                $('#jFooter').on('click', '.aui-bar-tab-item', function() {
                    var index = $(this).attr('data-index');
                    if (!$(this).hasClass('aui-active')) {
                        $(this).addClass('aui-active').siblings().removeClass('aui-active');
                    }
                    switch (index){
                        case '0':
                            self.methods().iconSwitch(false);
                            common.methods().openFrame('main_frm','./html/main_frm.html',0,'',true);
                            break;
                        case '1':
                            self.methods().iconSwitch(true);
                            common.methods().openFrame('welcome_frm','./html/welcome/welcome_frm.html',0,'',true);
                            break;
                        case '2':
                            self.methods().iconSwitch(false);
                            break;
                    }
                })
            };

            /**
             * @description: ajax管理
             */
            Index.prototype.https = function() {
                var self = this;
                return {

                };
            };

            /**
             * @description: 方法管理
             */
            Index.prototype.methods = function() {
                var self = this;
                return {
                    iconSwitch:function (showAdd) { // 中间图标的切换
                        var add = $('.add');
                        var keai = $('.keai');
                        if(showAdd){
                            add.removeClass('aui-hide');
                            keai.addClass('aui-hide');
                        }else {
                            keai.removeClass('aui-hide');
                            add.addClass('aui-hide');
                        }
                    }
                };
            };

            new Index();
        });
    };
</script>

</html>
